---
layout: default
---

{% if page.image %}
<link rel="preload" as="image" href="{{ page.image }}" />
{% endif %}

<div class="container">
  <div class="post-header">
    <div class="post-meta">
      <span class="post-date">{{ page.date | date: "%Y. %m. %d" }}</span>
      {% if page.tags %}
        {% for tag in page.tags %}
          <span class="post-tag">{{ tag }}</span>
        {% endfor %}
      {% endif %}
    </div>
    <h1>{{ page.title }}</h1>
  </div>

  <article class="post-content">
    {{ content }}
    <a href="{{ '/' | relative_url }}" class="back-link">← 목록으로 돌아가기</a>
  </article>

  <!-- 소셜 공유 버튼 -->
  <div class="share-buttons">
    <span class="share-label">공유하기</span>
    <button class="share-btn kakao" onclick="shareKakao()" aria-label="카카오톡 공유">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 3C6.5 3 2 6.6 2 11c0 2.8 1.9 5.3 4.7 6.7-.2.8-.6 2.7-.7 3.1 0 .2.1.4.3.4.1 0 .3-.1.4-.2.6-.4 3.3-2.1 4.3-2.7.3 0 .7.1 1 .1 5.5 0 10-3.6 10-8S17.5 3 12 3z"/>
      </svg>
    </button>
    <button class="share-btn twitter" onclick="shareTwitter()" aria-label="X(트위터) 공유">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
      </svg>
    </button>
    <button class="share-btn facebook" onclick="shareFacebook()" aria-label="페이스북 공유">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
      </svg>
    </button>
    <button class="share-btn copy" onclick="copyURL()" aria-label="URL 복사" id="copyBtn">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
      </svg>
    </button>
    <!-- ★ Web Share API 버튼 (모바일 네이티브 공유) -->
    <button class="share-btn native" onclick="shareNative()" aria-label="공유" id="nativeShareBtn" style="display:none;">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="18" cy="5" r="3"></circle>
        <circle cx="6" cy="12" r="3"></circle>
        <circle cx="18" cy="19" r="3"></circle>
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
      </svg>
    </button>
  </div>

  <!-- 관련글 -->
  {% assign related_posts = site.posts | where: "category", page.category | where_exp: "post", "post.url != page.url" | limit: 4 %}
  {% if related_posts.size > 0 %}
  <div class="related-posts">
    <h2>관련 글</h2>
    <div class="related-grid">
      {% for post in related_posts %}
      {% if post.naver_url %}
      <a href="{{ post.naver_url }}" target="_blank" class="related-card">
      {% else %}
      <a href="{{ post.url | relative_url }}" class="related-card">
      {% endif %}
        <div class="related-card-meta">{{ post.date | date: "%Y. %m. %d" }}</div>
        <div class="related-card-title">{{ post.title }}</div>
      </a>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Disqus 댓글 -->
  <div class="comments">
    <div id="disqus_thread"></div>
    <script>
    var disqus_config = function () {
      this.page.url = "{{ page.url | absolute_url }}";
      this.page.identifier = "{{ page.id }}";
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://brothrone-travel.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</div>

<script>
  const pageUrl = "{{ page.url | absolute_url }}";
  const pageTitle = "{{ page.title | escape }}";
  const pageImage = "{{ page.image | absolute_url }}";
  const pageDescription = "{{ page.excerpt | strip_html | truncate: 100 | escape }}";

  // ★ 카카오 — SDK 로드 확인 후 초기화
  function initKakao() {
    if (window.Kakao && !window.Kakao.isInitialized()) {
      // 카카오 디벨로퍼스에서 발급받은 JavaScript 앱 키를 아래에 입력하세요
      // https://developers.kakao.com 에서 앱 생성 후 키 확인
      Kakao.init('633bea9d67448561d14b00f31281c957');
    }
  }

  function shareKakao() {
    // 카카오 키가 없으면 네이티브 공유 또는 URL 복사로 대체
    if (!window.Kakao || !window.Kakao.isInitialized()) {
      alert('카카오 공유를 사용하려면 카카오 앱 키가 필요합니다.\nURL을 복사해서 공유해 주세요.');
      copyURL();
      return;
    }
    Kakao.Share.sendDefault({
      objectType: 'feed',
      content: {
        title: pageTitle,
        description: pageDescription,
        imageUrl: pageImage,
        link: { mobileWebUrl: pageUrl, webUrl: pageUrl },
      },
      buttons: [{
        title: '글 보기',
        link: { mobileWebUrl: pageUrl, webUrl: pageUrl },
      }],
    });
  }

  function shareTwitter() {
    const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(pageTitle)}&url=${encodeURIComponent(pageUrl)}`;
    window.open(url, '_blank', 'width=550,height=450,noopener,noreferrer');
  }

  function shareFacebook() {
    const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(pageUrl)}`;
    window.open(url, '_blank', 'width=550,height=450,noopener,noreferrer');
  }

  function copyURL() {
    // ★ clipboard API + fallback 처리
    const btn = document.getElementById('copyBtn');
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(pageUrl).then(() => {
        showCopied(btn);
      }).catch(() => {
        fallbackCopy(btn);
      });
    } else {
      fallbackCopy(btn);
    }
  }

  function fallbackCopy(btn) {
    // 구형 브라우저 대응
    const textarea = document.createElement('textarea');
    textarea.value = pageUrl;
    textarea.style.cssText = 'position:fixed;opacity:0;';
    document.body.appendChild(textarea);
    textarea.select();
    try {
      document.execCommand('copy');
      showCopied(btn);
    } catch(e) {
      alert('URL: ' + pageUrl);
    }
    document.body.removeChild(textarea);
  }

  function showCopied(btn) {
    btn.classList.add('copied');
    btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>';
    setTimeout(() => {
      btn.classList.remove('copied');
      btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>';
    }, 2000);
  }

  // ★ 모바일 Web Share API 지원 시 네이티브 공유 버튼 표시
  function shareNative() {
    if (navigator.share) {
      navigator.share({
        title: pageTitle,
        text: pageDescription,
        url: pageUrl,
      });
    }
  }

  // 모바일이면 네이티브 공유 버튼 표시
  if (navigator.share) {
    document.getElementById('nativeShareBtn').style.display = 'flex';
  }

  // 카카오 SDK 비동기 로드
  (function() {
    var script = document.createElement('script');
    script.src = 'https://developers.kakao.com/sdk/js/kakao.min.js';
    script.defer = true;
    script.onload = initKakao;
    document.head.appendChild(script);
  })();
</script>

<!-- ★ 포스트 이미지 lazy loading -->
<script defer>
  document.querySelectorAll('.post-content img').forEach(img => {
    if (!img.hasAttribute('loading')) {
      img.setAttribute('loading', 'lazy');
    }
    // ★ WebP 지원 확인 후 src 교체
    const src = img.getAttribute('src');
    if (src && src.match(/\.(jpg|jpeg|png)$/i)) {
      const webpSrc = src.replace(/\.(jpg|jpeg|png)$/i, '.webp');
      const testImg = new Image();
      testImg.onload = function() { img.src = webpSrc; };
      testImg.onerror = function() { /* 원본 유지 */ };
      testImg.src = webpSrc;
    }
  });
</script>
